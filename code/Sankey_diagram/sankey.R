## clear plots
if(!is.null(dev.list()))dev.off()

## clean workspace
rm(list=ls())

## set working directory
setwd(dirname(rstudioapi::getSourceEditorContext()$path))

data_dir<-"../../dataset/"
output  <-"../../output/"

library("tidyverse")
library("tidyr")
library("ggalluvial")
# nice themes
library("ggthemes")
# nice colors
library("viridis")
library("ggplot2")


#############Sankey diagram construction####################
Sankey1<-structure(
  list( id = 1:428, wave1=c("Moderate", "Moderate", "Moderate", "Low", 
                            "Moderate", "Moderate", "Low",      "Moderate", 
                            "Moderate", "Low",      "Moderate", "Moderate",
                            "Moderate", "Moderate", "Moderate", "Moderate",
                            "Low",      "Moderate", "Moderate", "Low",
                            "Low",      "Moderate", "Low",      "Moderate",
                            "Moderate", "Moderate", "Moderate", "Moderate",
                            "Moderate", "Moderate", "Moderate", "Moderate",
                            "Moderate", "Moderate", "Moderate", "Moderate",
                            "Moderate", "Moderate", "Moderate", "Moderate",
                            "Moderate", "High",     "Moderate", "Moderate",
                            "Moderate", "Moderate", "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "High",
                                             "Low",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "High",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "Moderate",
                                             "High",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "High",
                                             "High",
                                             "High",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Low",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate",
                                             "High",
                                             "Moderate",
                                             "High",
                                             "High",
                                             "Moderate",
                                             "Moderate",
                                             "Moderate"
), wave2 = c("Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "High",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Low",
             "High",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Low",
             "High",
             "High",
             "High",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate"
), wave3 = c("Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "High",
             "High",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "High",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Low",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Low",
             "Low",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Low",
             "Moderate",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Low",
             "Low",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "Moderate",
             "High",
             "High",
             "Moderate",
             "Low"
)
), row.names = c(NA, -428L), class = "data.frame" )

Sankey2 <- count(Sankey1, wave1, wave2, wave3) %>%
  mutate(id = row_number())

Sankey3 <- gather(Sankey2, wave, vulnerability, -n,-id)

##---------------------Recategorizing wave to year----------------------------##
Sankey3$wave <- factor(Sankey3$wave, levels = c("wave1", "wave2", "wave3"), labels = c("2006", "2009", "2012"))

Sankey4 <- Sankey3 %>%
  mutate(
    vulnerability = as.factor(vulnerability),
    vulnerability = fct_relevel(vulnerability, "High", "Moderate", "Low")
  )

Sankey4 %>%
  ggplot(aes(
    x = wave,
    stratum = vulnerability,
    alluvium = id,
    y = n,
    fill = vulnerability
  )) +
  geom_flow() +
  geom_stratum(alpha = .5) +
  theme_tufte(base_size = 15) +
  labs(x = "Year",
       y = "Frequency",
       fill = "Vulnerability") +
  scale_fill_manual(values = c("red", "white", "green"))


#savePlot(filename = paste0(output, "graphs and figures/sankey_diagram.pdf"), type = "pdf")  
  
  